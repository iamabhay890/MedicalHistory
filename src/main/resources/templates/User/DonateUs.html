<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <title>Formatted Report</title>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link href="https://use.fontawesome.com/releases/v5.10.2/css/all.css" rel="stylesheet"/>
    <!-- Bootstrap CSS -->
    <link href="https://www.markuptag.com/bootstrap/5/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://www.markuptag.com/bootstrap/5/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" ntegrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .img-fluid{
        height:40px;
        }

     .btnl a{
    color : White;
    font-weight: bold;
    text-decoration: none;
     }
       .my_profile_picture{
	width: 40px;
	height: 40px;
	object-fit:cover;
	border-radius:40%;
}
    </style>
</head>

<body>
<header th:replace="User/userBlock::header1"></header>
<div class="container">
    <div class="form-group" style="margin-top:100px">
        <div class="row">
            <div class="col-md-5 offset-md-4">
                <span>Donate Us</span>
                <input type="text" id="amount_filed" />
                <div class="text-center mt-3">
                <button class="btn btn-success" onclick="paymentStart()">Pay</button>
                </div>
            </div>
        </div>
    </div>

</div>
<script>
    const paymentStart=()=>{
    console.log("payment Started...");

    let amount = $("#amount_filed").val();

    console.log(amount);

    if(amount==''|| amount==null){
         swal("Sorry!","Amount is required to pay !!", "error");
            return;
    }

    //sending request to server 
    $.ajax(
        {
            url:`/createOrder`,
            data:JSON.stringify({amount:amount,info:'order_request'}),
            contentType:'application/json',
            type:'POST',
            dataType:'json',
            success:function(response){
                //involked when success
                console.log(response);

                if(response.status=='created'){
                    let options={
                    key:"rzp_test_BL0BgqpoAReFUm",
                    amount:response.amount,
                    currency:"INR",
                    name:"Medical History",
                    description:"Donaction",
                    image:"https://media-exp1.licdn.com/dms/image/C4E03AQHijALYhHJjtg/profile-displayphoto-shrink_400_400/0/1616135276199?e=1664409600&v=beta&t=sEzWFO1rc64NMw-U9QU4I325qe24mEDMmXrUtRO-3F0",
                    order_id:response.id,
                    handler:function(response){
                        console.log(response.razorpay_payment_id);
                        console.log(response.razorpay_order_id);
                        console.log(response.razorpay_signature);
                        console.log("Payment Successfull !!");
                        swal("Thankyou for Donating us!"," Payment Successfull !!", "success");
                    },
                    prefill: {
                                name: "",
                                email: "",
                                contact: ""
                    },
                    notes: {
                        address: "Intelegencia Analytics Noida"
                    },
                    theme: {
                        color: "#3399cc"
                    }
                    };
                    let rzp = new Razorpay(options);  
                   
                    rzp.on('payment.failed', function (response){
                        console.log(response.error.description);
                        console.log(response.error.code);
                        console.log(response.error.step);
                        console.log(response.error.source);
                        console.log(response.error.metadata.order_id);
                        console.log(response.error.reason);
                        console.log(response.error.metadata.payment_id);
                        swal("Sorry!","Payment Failed :(", "error");
                    });
                    rzp.open();
                    
                }
            },
            error:function(error){
                //involked when error
                console.log(error);
                alert("something went wrong !!");
            }   
            
        }


    )

}
</script>
</body>
</html>